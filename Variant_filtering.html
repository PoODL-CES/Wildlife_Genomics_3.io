<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VCF Filtering and PCA Workflow</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 40px;
      background-color: #f9f9f9;
    }
    code, pre {
      background-color: #eee;
      padding: 10px;
      display: block;
      overflow-x: auto;
      white-space: pre-wrap;
      border-left: 5px solid #ccc;
    }
    h2, h3 {
      color: #333;
    }
  </style>
</head>
<body>

  <h2>VCF Filtering and PCA Workflow</h2>

  <p>Create symbolic link to the variants file</p>
  <p><code>ln -s /data/PwaniGenomics/variants_renamed.vcf.gz</code></p>
    
  <p>Variants file can also be downloaded from <a href=https://tinyurl.com/Popgen2025PUZenodo> here </a> </p>
  
  <h3>1. Apply Base Quality, Genotype Quality, INDELS, "PASS" filters</h3>
  <p>Apply quality-based filters to retain high-confidence variants. Remove all variants with Q<30, GQ<30, remove all Indels and retain only the variants that are flagged as "PASS". </p>

  <h3>2. Remove non-neutral loci</h3>
  <p>Then remove any variant that deviates from HWE with a chi-square P value of less than 0.01.</p>

  <h3>3. Apply Individual Missingness Filter</h3>
  <p>Remove individuals with more than 60% missing data:</p>
  

  <h3>4. Apply Site Missingness Filter</h3>
  <p>Filter out variants that are not commonly genotyped across individuals.</p>


  <h3>5. Record Variant Counts for Different Missingness Thresholds</h3>
  <p>Extract and save the number of variants remaining at each threshold (0.1 to 0.9):</p>
  

  <h3>6. Plot <code>variant_counts.txt</code> Using ggplot2 in R</h3>

  <h3>7. Apply Final Missingness Filter (Max Missing = 0.6)</h3>
  <p>This retains variants that are present in at least 60% of individuals.</p>
  

  <h3>8. Use Site Mean Depth Filter</h3>
  <p>Calculate mean depth per variant:</p>


  <h3>9. Extract Depth Values Between 5th and 97.5th Percentiles</h3>
  <p>Use R or Python to compute the 0.05 and 0.975 quantiles and filter sites accordingly.</p>

  <h3>10. Apply Depth Filters to Retain Only Mid 95% Variants</h3>


  <h3>11. Perform PCA</h3>
  <p>Convert to PLINK format and run PCA:</p>
 
</body>
</html>
